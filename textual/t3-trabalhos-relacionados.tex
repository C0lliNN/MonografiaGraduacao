\chapter{Trabalhos Relacionados}
\label{cap:trabalhos}
Este capítulo apresenta os trabalhos relacionados ao objeto de pesquisa obtidos utilizando o protocolo descrito na seção a seguir.

\section{Protocolo}
Esta seção apresenta o protocolo de mapeamento sistemático da literatura usado para atingir os objetivos da pesquisa.

\subsection{Questões de pesquisa}
\label{section:questoes_pesquisa}
\begin{enumerate}
    \item[Q1:] Quais são as principais estratégias para elaboração de sistemas com microsserviços e \acrshort{ddd}?
    \item[Q2:] Quais são os principais desafios na utilização de \acrshort{ddd} como estratégia de delimitação de microsserviços?
    \item[Q3:] Quais são os anti-padrões a serem evitados na utilização de \acrshort{ddd} com microsserviços?
    
\end{enumerate}

\subsection{Estratégia de busca}
Esta seção apresenta a estratégia de buscas de artigos científicos e livros relacionados à pesquisa. As ferramentas utilizadas para realizar as buscas são:
\begin{itemize}
    \item \textbf{Periódicos Capes:} É uma ferramenta disponibilizada pelo governo federal para uso de estudantes e pesquisadores. Acessando através da instituição de ensino ou pesquisa, é possível ter acesso completo a uma grande quantidade de artigos científicos publicados em variadas revistas, conferências e universidades. A principal vantagem dessa ferramenta é a possibilidade de ler o conteúdo integral de grande parte das publicações disponíveis. Por outro lado, as expressões de busca atualmente suportadas são bem limitadas.
    \item \textbf{\english{Scopus:}} Trata-se de um ferramenta similar ao Periódicos Capes. No entanto, o \english{Scopus} permite a elaboração de expressões de buscas mais complexas e sofisticadas, servindo para descobrir publicações não detectadas pelas outras plataformas. Além disso, possui um acervo bem mais amplo que o Periódicos Capes. Entretanto, algumas publicações não podem ser vistas na íntegra de forma gratuita.
    \item \textbf{\english{Google Docs:}} Ferramenta desenvolvida pela \english{Google LLC} que permite a criação e edição de documentos de texto. Suas grandes vantagens em relação a ferramentas de outros fornecedores são as avançadas ferramentas de colaboração e a possibilidade de acesso por meio de navegadores \english{web}, sem necessidade de instalação de \english{software} específico.
    \item \textbf{\english{Google Sheets}}: Com as mesmas características e vantagens do \english{Google Docs}, essa ferramenta fornece recursos para elaboração de planilhas de cálculo. É muito útil para realizar análise de dados simples e também visualizar e apresentar dados tabulares.
\end{itemize}

Como grande parte das publicações na área de computação são em inglês, esta pesquisa utiliza esse idioma para fazer buscas nas ferramentas indicadas. Além disso, \acrfull{ams} e \acrfull{ddd} são relativamente recentes, as buscas se limitaram a publicações feitas nos últimos 20 anos.

Os termos-chave para realização das buscas são: Microsserviço, \acrshort{ddd} e \acrlong{ddd}. Como a busca é feita em inglês, se usará \english{microservice} nas buscas.
\subsection{Expressão de busca}
\label{section:string_busca}

\begin{quadro}[H]
\centering

\setlength{\tabcolsep}{0.8em} % for the horizontal padding
\renewcommand{\arraystretch}{1.5}% for the vertical padding
\caption{Expressão de busca utilizada}
\begin{tabular}{|p{4.5in}|}

\hline
Expressão de Busca \\ \hline
\english{( ( TITLE-ABS-KEY ( microservice ) AND TITLE-ABS-KEY ( domain-driven AND design ) ) OR ( TITLE-ABS-KEY ( microservice ) AND TITLE-ABS-KEY ( ddd ) ) )} \\ \hline

\end{tabular}
\label{quad:string_busca}
\fonte{o autor}
\end{quadro}

No \autoref{quad:string_busca}, percebe-se que a expressão de busca pretende retornar todas as publicações que contenham as palavras chaves no título, resumo ou na seção de \english{keywords}.

\subsection{Estratégia de seleção}
A seguir são apresentados critérios para inclusão de publicações na pesquisa.
\label{section:criterios_inclusao}
\begin{itemize}
    \item Texto completo disponível de forma gratuita pelo portal Periódicos Capes.
    \item Materiais relacionados ao tópico de interesse, ou seja, título ou resumo.
    \item Publicações com ao menos 5 citações.
\end{itemize}

Por outro lado, estes são os critérios para exclusão de publicações.
\label{section:criterios_exclusao}
\begin{itemize}
    \item Publicações duplicadas.
    \item Materiais que não dispõem de informação relevante para responder às questões de pesquisa.
\end{itemize}

\subsection{Estratégia para extração de dados e análise}
Para atingir o objetivo do mapeamento da literatura, são filtrados manualmente nos artigos selecionados segundo os critérios de inclusão e exclusão. A partir da listagem reduzida, todas as publicações são lidas de forma integral.
Adicionalmente, todos os gráficos e tabelas nos artigos selecionados são avaliados visando extrair algum dado que permita realizar a comparação entre aspectos quantitativos das estratégias como, tempo de resposta, latência e taxa de transferência.

Informações qualitativas como recomendações, destaques, conceitos e estudos de casos são registrados em um documento no \english{\href{https://docs.google.com/document/d/1-dXE9_2-CtfDePG9Opkcyipq0F0dcYJ-Z_gbhi_qDhs/edit?usp=sharing}{Google Docs}}. Dados quantitativos como taxa de transferência, latência, tempo de processamento são armazenados em uma planilha no \english{\href{https://docs.google.com/spreadsheets/d/1R-PbCisie8QHARzF2rYtDx8UPOWksEeH-6-SEqIOTLg/edit?usp=sharing}{Google Sheets}}. 

A pesquisa é executada seguindo os passos a seguir:
\begin{enumerate}
    \item As expressões de busca citadas são inseridas nas ferramentas mencionadas.
    \item É feito o armazenamento das publicações retornadas em uma \href{https://docs.google.com/spreadsheets/d/1rtH8Jl1EHguqZ4Py2mgV3pab7IQzt72-Sv2S1jPzLsQ/edit?usp=sharing}{planilha de cálculo}.
    \item As publicações retornadas são filtradas conforme os critérios de inclusão e exclusão.
    \item Em cada artigo selecionado, é realizada a extração dos dados relevantes para responder às questões de pesquisa.
    \item Finalmente, são produzidas respostas para questões de pequisa com as informações extraídas das publicações.
\end{enumerate}

\section{Caracterização dos estudos}

\begin{figure}
\centering
\caption{Número de publicações ao longo dos anos}
\begin{tikzpicture}
\begin{axis}[
    width=0.8\textwidth,
    height=0.6\textwidth,
    xlabel={Ano},
    ylabel={Número de publicações},
    xtick=data, % Use data points for x-axis ticks
    xticklabel style={/pgf/number format/1000 sep=}, % Remove comma from tick labels
    ymajorgrids=true, % Show y-axis grid lines
    grid style=dashed, % Style of grid lines
    legend pos=north west, % Position of the legend
]
\addplot[
    smooth, % Show only the dots without connecting lines
    mark=*,
    mark options={scale=1.5}, % Adjust dot size
] table [x=Year, y=Publications, col sep=comma] {media/publications_per_year.csv};
\end{axis}
\end{tikzpicture}
\legend{Fonte: \english{Scopus}}
\label{fig:publications_per_year}
\end{figure}

Na \autoref{fig:publications_per_year}, pode-se observar a quantidade de publicações por ano, encontradas a partir da expressão de busca descrita na seção \ref{section:string_busca}. No total, foram obtidos 65 resultados. Percebe-se, claramente, um aumento exponencial no número de publicações sobre o tema, principalmente a partir de 2019, demonstrando crescimento no interesse de se realizar pesquisas sobre o assunto.

\begin{figure}
    \centering
    \caption{Publicações por localização}
    \pgfplotstableread[col sep=comma]{media/publications_per_territory.csv}\datatable

    \begin{tikzpicture}
        \begin{axis}[
            xbar,
            bar width=0.5cm,
            height=0.6\textwidth,
            width=0.8\textwidth,
            symbolic y coords={Alemanha, China, Áustria, Itália, Suíça, Taiwan, Estados Unidos, Indonésia, Brasil, Colômbia},
            ytick=data,
            xlabel={Publicações},
            ylabel={Localização},
            nodes near coords,
            nodes near coords align={horizontal},
            ]
            \addplot table[x=Publications, y=Territory] {\datatable};
        \end{axis}
    \end{tikzpicture}
    \legend{Fonte: \english{Scopus}}
    \label{fig:publications_per_territory}
\end{figure}

A Alemanha lidera em número de publicações, como pode ser visualizado na \autoref{fig:publications_per_territory}. Por outro lado, o Brasil só possui duas entre as sessenta e cinco publicações retornadas.

Utilizando-se os critérios de inclusão e exclusão descritos nas seções \ref{section:criterios_inclusao} e \ref{section:criterios_exclusao}, respectivamente, dos 65 artigos retornados, 27 foram selecionados inicialmente. Após realizada as leituras, apenas 16 publicações mostraram-se relevantes para responder às questões de pesquisa e/ou apoiar na elaboração do estudo de caso. Esta listagem está disponível no \autoref{quad:publicacoes_selecionadas}. 

\begin{quadro}
\centering

\setlength{\tabcolsep}{0.8em} % for the horizontal padding
\renewcommand{\arraystretch}{1.5}% for the vertical padding
\begin{tabular}{p{3in}|p{1in}|p{0.5}}
\hline

\multicolumn{1}{|p{4in}}{\textbf{Título}} & 
\multicolumn{1}{|p{0.5in}|}{\textbf{Ano}} \\
\hhline{---}

\multicolumn{1}{|p{4in}}{\english{Microservice Migration Using Strangler Fig Pattern and Domain-Driven Design}} & 
\multicolumn{1}{|p{0.5in}|}{\citeyear{ma20221285}} \\
\hhline{---}

\multicolumn{1}{|p{4in}}{\english{Microservice architecture and model-driven development: Yet singles, Soon Married ?}} & 
\multicolumn{1}{|p{0.5in}|}{\citeyear{Rademacher2018}} \\
\hhline{---}

\multicolumn{1}{|p{4in}}{\english{Does Domain-Driven Design Lead to Finding the Optimal Modularity of a Microservice?}} & 
\multicolumn{1}{|p{0.5in}|}{\citeyear{Vural202132721}} \\
\hhline{---}

\multicolumn{1}{|p{4in}}{\english{Modeling Microservices with DDD}} & 
\multicolumn{1}{|p{0.5in}|}{\citeyear{Merson20207}} \\
\hhline{---}

\multicolumn{1}{|p{4in}}{\english{Following Domain Driven Design principles for Microservices decomposition: Is it enough?}} & 
\multicolumn{1}{|p{0.5in}|}{\citeyear{Farsi2021}} \\
\hhline{---}

\multicolumn{1}{|p{4in}}{\english{An Ontology-based Approach for Domain-driven Design of Microservice Architectures}} & 
\multicolumn{1}{|p{0.5in}|}{\citeyear{Diepenbrock20171777}} \\
\hhline{---}

\multicolumn{1}{|p{4in}}{\english{Challenges of domain-driven microservice design: A model-driven perspective}} & 
\multicolumn{1}{|p{0.5in}|}{\citeyear{Rademacher201836}} \\
\hhline{---}

\multicolumn{1}{|p{4in}}{\english{Model-based engineering for microservice architectures using Enterprise Integration }} & 
\multicolumn{1}{|p{0.5in}|}{\citeyear{Petrasch2017}} \\
\hhline{---}

\multicolumn{1}{|p{4in}}{\english{Patterns on Deriving APIs and their Endpoints from Domain Models }} & 
\multicolumn{1}{|p{0.5in}|}{\citeyear{Singjai2021}} \\
\hhline{---}

\multicolumn{1}{|p{4in}}{\english{Refactoring with domain-driven design in an industrial context: An action research report}} & 
\multicolumn{1}{|p{0.5in}|}{\citeyear{Ozkan2023}} \\
\hhline{---}

\multicolumn{1}{|p{4in}}{\english{A microservice based reference architecture model in the context of enterprise architecture}} & 
\multicolumn{1}{|p{0.5in}|}{\citeyear{Yale20171856}} \\
\hhline{---}

\multicolumn{1}{|p{4in}}{\english{Design of Domain-driven Microservices-based Software Talent Evaluation and Recommendation System}} & 
\multicolumn{1}{|p{0.5in}|}{\citeyear{Zhang2022310}} \\
\hhline{---}

\multicolumn{1}{|p{4in}}{\english{Partitioning microservices: A domain engineering approach}} & 
\multicolumn{1}{|p{0.5in}|}{\citeyear{Joselyne201843}} \\
\hhline{---}

\multicolumn{1}{|p{4in}}{\english{Practitioner Views on the Interrelation of Microservice APIs and Domain-Driven Design: A Grey Literature Study Based on Grounded Theory}} & 
\multicolumn{1}{|p{0.5in}|}{\citeyear{Singjai202125}} \\
\hhline{---}

\multicolumn{1}{|p{4in}}{\english{A Systematic Framework of Application Modernization to Microservice based Architecture}} & 
\multicolumn{1}{|p{0.5in}|}{\citeyear{Joselyne2021}} \\
\hhline{---}

\multicolumn{1}{|p{4in}}{\english{Domain-specific language and tools for strategic domain-driven design, context mapping and bounded context modeling}} & 
\multicolumn{1}{|p{0.5in}|}{\citeyear{Kapferer2020299}} \\
\hhline{---}

\end{tabular}
\caption{Publicações selecionadas}
\label{quad:publicacoes_selecionadas}
\end{quadro}


\section{Estratégias para elaboração de sistemas com microsserviços e DDD}
Todas as publicações revisadas sugerem o mapeamento de cada \nameref{section:bounded_context} para um microsserviço. \citeonline{Vural202132721} afirmam que o objetivo principal da delimitação é alcançar serviços com baixo acoplamento e alta coesão. Porém, o grande desafio está na definição de maneira apropriada do escopo de cada \acrshort{bc}.

\citeonline{Singjai202125} e \citeonline{ma20221285} mencionam os padrões \english{\acrfull{ohs}} e \english{\acrfull{acl}} como estratégias para comunicação, conceitualmente, entre \hyperref[section:bounded_context]{Bounded Contexts}. No \acrshort{ohs}, o serviço que envia as mensagens implementa uma camada extra com objetivo de realizar a tradução para um formato que possa ser processado pelo serviço receptor. Dessa forma, os detalhes de implementação do serviço cliente não são expostos, diminuindo o acoplamento entre as partes. Semelhantemente, o \acrshort{acl} é uma camada extra inserida no serviço que recebe as mensagens. Trata-se de uma abordagem útil quando o serviço receptor não deseja aderir ao contrato do componente que produz as mensagens \cite{evans2004ddd}.

Outro ponto importante levantando no material revisado é o mapeamento do modelo de domínio para uma \acrfull{api} para possibilitar o consumo das funcionalidades tanto por outros serviços quanto de aplicações cliente. Algumas opções citadas por \citeonline{Singjai202125} são:
\begin{itemize}
    \item Expor todo o modelo de domínio em uma relação de 1 para 1 com a \acrshort{api}.
    \item Expor uma parte do modelo como uma \acrshort{api}.
    \item Expor cada \acrshort{bc} como uma \acrshort{api}.
    \item Expor parte dos \acrshort{bc}s como \acrshort{api}s.
\end{itemize}

As alternativas mais indicadas são a exposição total ou de grupo de \acrshort{bc}s como \acrshort{api}s. Além disso, \citeonline{Singjai202125} e \citeonline{Singjai2021} levantam abordagens para definição do contrato de \acrshort{api} de acordo com modelo de domínio. As duas principais opões apresentadas pelos autores são: explicitamente definir o contrato de \acrshort{api} e extrair o contrato de \acrshort{api} a partir do modelo. \citeonline{Singjai202125} argumenta que ambas opções auxiliam na obtenção da separação do contrato de \acrshort{api} e das responsabilidades do modelo de domínio.

Para este trabalho de conclusão de curso, a estratégia de mapeamento de um \acrshort{bc} para um microsserviço é utilizada. Com objetivo de habilitar a comunicação entre subdomínios, o padrão \acrfull{ohs} é empregado. Adicionalmente, o contrato de \acrshort{api} será definido explicitamente a partir do modelo de domínio. Assim, pretende-se utilizar as estratégias mais indicadas pelos autores revisados na elaboração do estudo de caso.

\section{Desafios na utilização de DDD como estratégia de delimitação de microsserviços}
\citeonline{Rademacher201836} menciona três principais desafios da utilização de \acrshort{ddd} no contexto da \acrshort{ams}. Adicionalmente, \citeonline{Diepenbrock20171777} cita desafios semânticos juntamente com sua proposta de metamodelo.

Para fomentar o foco em conceitos relevantes e \english{design} efetivo, modelos de domínio tipicamente omitem informações obrigatórias para extração de microsserviços, como:
\begin{itemize}
    \item Interfaces e operações;
    \item Parâmetros e tipos de retorno das operações
    \item \english{Endpoints}, protocolos e formatos de mensagens.
\end{itemize}
\cite{Rademacher201836}.

Informações específicas sobre esses pontos são cruciais para implementação dos serviços. Considerando diferentes \acrshort{bc}s conectados entre si no modelo, e que cada \acrshort{bc} é mapeado para um microsserviço, um componente vai necessitar acessar instâncias de um outro serviço. Assim, uma operação desse tipo deve ser fornecida e usualmente não é especificada no modelo, deixando espaço para ambiguidade \cite{Rademacher201836}.

Modelos de domínio intencionalmente não compreendem componentes de infraestrutura da \acrshort{ams} \cite{Rademacher201836}. Esses componentes incluem \english{API Gateways}, \english{containers}, banco de dados, entre outros. Por outro lado, requisitos do modelo podem afetar questões técnicas e esses pontos devem ser documentados separadamente do modelo de domínio \cite{Rademacher201836}. Por exemplo, caso um microsserviço que realize o gerenciamento de usuários necessite ser acessível externamente para faturamento, configurações em diferentes componentes técnicos como \english{API Gateway} necessitarão ser aplicadas.

Responsabilidade sobre um microsserviço é geralmente atribuída a um único time, devido à alta coesão e baixo acoplamento \cite{Rademacher201836}. Essa equipe é responsável pela implementação do serviço, operação, \english{design} e manutenção desse \acrfull{bc}. Dessa forma, surgem desafios relacionados a visibilidade dos modelos e gerenciamento de alterações.

Primeiramente, é crucial definir a visibilidade de cada \acrshort{bc}, ou seja, especificar quais equipes terão acesso a quais modelos de domínios \cite{Rademacher201836}. Além disso, a permissão para realizar alterações é uma consideração essencial. Embora seja possível conceder a outras equipes privilégios para modificar outros \acrshort{bc}, essa abordagem apresenta a desvantagem de possibilitar alterações, por vezes críticas, efetuadas por profissionais que não estão familiarizados com o contexto específico. No entanto, restringir exclusivamente à equipe responsável a capacidade de realizar mudanças pode resultar em gargalos significativos, especialmente em projetos envolvendo diversos contextos.

\citeonline{Diepenbrock20171777} apresenta uma série de desafios semânticos na elaboração de microsserviços com \acrshort{ddd}. Inicialmente, um problema de semântico típico ocorre quando um atributo de um conceito de domínio é derivado de outro atributo. Por exemplo, quando um atributo de uma entidade é criado a partir da concatenação de dois outros atributos de outra entidade, ocorre um problema de semântica porque os dados ficam fragmentados.

Simultaneamente, é importante reconhecer que diferentes \acrshort{bc}s podem interpretar os conceitos de domínio compartilhados de maneiras distintas \cite{Diepenbrock20171777}. Nesse contexto, surgem desafios como atributos com nomes diversos, mas significados idênticos, bem como propriedades com o mesmo nome, porém, com significados diferentes. Esse risco é amplificado no contexto da \acrshort{ams}, onde é comum que diferentes \acrshort{bc}s sejam desenvolvidos por equipes distintas. Esse ambiente descentralizado pode potencializar a disparidade de interpretações e a falta de consistência nos conceitos de modelos compartilhados.

Além disso, um mecanismo de definição de identificadores únicos deve ser definido entre as equipes para permitir a identificação semântica de diferentes conceitos do modelo com objetivo de tornar os serviços capazes de distinguir diferentes elementos em um contexto distribuído \cite{Diepenbrock20171777}.

Por essas motivações, \citeonline{Diepenbrock20171777} apresenta uma abordagem para \acrshort{ddd} no contexto da \acrshort{ams}. O autor propõe um metamodelo que representa a sintaxe abstrata de um linguagem formal de modelagem. Em outras palavras, ele define os conceitos suportados pela linguagem e seus relacionamentos. Os principais componentes do metamodelo são: \english{External Context}, \english{\acrlong{bc}}, \english{Domain Model}, \english{Attribute} e \english{Association}. O objetivo principal desse modelo é minimizar os impactos dos desafios semânticos da utilização dessas tecnologias \cite{Diepenbrock20171777}.

\section{Anti-padrões a serem evitados}
\citeonline{Farsi2021}, \citeonline{Vural202132721}, \citeonline{Singjai2021}, \citeonline{Ozkan2023} e \citeonline{Singjai202125} identificaram uma série de anti-padrões no contexto da \acrshort{ams} e \acrshort{ddd}. Um compilado pode ser observado no \autoref{quad:anti_padroes}.

\begin{quadro}
\centering
\caption{Anti-padrões}
\setlength{\tabcolsep}{0.8em} % for the horizontal padding
\renewcommand{\arraystretch}{1.5}% for the vertical padding
\begin{tabular}{|p{1in}|p{3.7in}|}
\hline

\textbf{Nome} & \textbf{Descrição} \\ \hline
\english{Chattiness of a service} &  Refere-se a excessiva comunicação entre microsserviços que gera ineficiência devido à latência de rede. \\ \hline
\english{Nanoservice} & Um serviço excessivamente granular no qual a sobrecarga de comunicação, manutenção e operação supera sua utilidade. \\ \hline
\english{Anemic domain model} & Trata-se de um modelo de domínio em que os objetos contém pouca ou nenhuma regra de negócio. As invariantes são misturadas com outras lógicas, o que dificulta manutenção e refatoração. \\ \hline
\english{Data class} & Similar ao \english{Anemic domain model}, esse tipo de classe só contem, além de atributos, \english{getters} e \english{setters}. Os comportamentos são criados fora da classe, o que reduz coesão e dificulta a manutenção. \\ \hline
\english{Distributed monoliths} & Refere-se a um sistema que externamente se assemelha a \acrlong{ams}, porém possui um alto nível de acoplamento entre os componentes, diminuindo assim as vantagens dos microsserviços. \\ \hline
\english{Start with API Design} & Trata-se de uma abordagem na qual o contrato de \acrshort{api} é definido antes do modelo de domínio. \citeonline{Singjai2021} levantou que esta estratégia costuma gerar a criação de \english{Anemic domain models}. \\ \hline
\english{Feature envy} & Acontece quando um método está mais interessado em uma classe diferente da que está inserido. \\ \hline
\english{Inappropiate intimacy} & Descreve um par de classes não relacionadas conceitualmente, mas que possuem grande acoplamento entre si. \\ \hline
\english{Message chain} & Uma cadeia de mensagem ocorre quando um cliente envia uma mensagem a outro objeto que, por sua vez, a envia outro o objeto e assim por diante. \\ \hline

\end{tabular}
\fonte{\citeonline{Farsi2021}, \citeonline{Vural202132721}, \citeonline{Singjai2021}, \citeonline{Ozkan2023} e \citeonline{Singjai202125}}
\label{quad:anti_padroes}
\end{quadro}

Os anti-padrões mencionados são importantes para o desenvolvimento do estudo de caso, pois devem ser evitados para que os benefícios da utilização conjunta de \acrshort{ddd} e \acrshort{ams} sejam alcançados.

\section{Discussões}
O mapeamento da literatura mostrou-se efetivo para responder às questões de pesquisa, na medida em que foram encontradas publicações que auxiliam na resolução das perguntas-chave. O levantamento das estratégias, desafios e anti-padrões foi realizado com êxito a partir de artigos de alta qualidade.

No entanto, publicações em outros idiomas que não foram revisadas, assim como publicações não indexadas pelas ferramentas de busca utilizadas, representam uma ameaça a validade da pesquisa. Isso se deve ao fato de que informações essenciais podem não ter sido revisadas devido a essas limitações.

Por fim, as informações obtidas nesse mapeamento contribuem tanto para atingir os objetivos gerais da pesquisa quanto para a elaboração do estudo de caso.
